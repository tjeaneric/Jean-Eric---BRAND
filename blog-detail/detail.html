<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="detail.css" />
    <script
      src="https://kit.fontawesome.com/125f9750f1.js"
      crossorigin="anonymous"
    ></script>

    <title>Blog Title</title>
  </head>
  <body>
    <header>
      <a href="/index.html"
        ><img class="my-logo" src="/img/logo1.png" alt=""
      /></a>

      <nav>
        <a href="/index.html">Home</a>
        <a href="/index.html">Services</a>
        <a href="/index.html">Resume</a>
        <a href="/index.html">Projects</a>
        <a href="/index.html">Blog</a>
        <a href="/index.html">Contact</a>
        <a class="login-link" href="/index.html">Login</a>
      </nav>
    </header>
    <div class="container">
      <main>
        <section class="blog-header">
          <h2>Latest News & Blog</h2>
          <h3>Jean Eric > Blog > Blog detail</h3>
        </section>

        <section id="article" class="row article">
          <figure class="blog-text"></figure>
          <!-- <figure class="blog-text">
            <img src="img/theme.jpg" alt="" />
            <div class="tag">
              <i class="fa-solid fa-tag tag-icon"></i>

              <h4>Software application</h4>
            </div>

            <p class="blog-p">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Lobortis
              eu placerat lorem condimentum nulla fusce dignissim. Adipiscing
              adipiscing tortor condimentum elit
            </p>
            <p class="blog-p">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nisi, ac
              aliquam arcu volutpat, massa purus in.
            </p>
            <div class="comment-row">
              <div class="like-row">
                <i class="fa-solid fa-thumbs-up like-comment"></i>
                <p>33</p>
              </div>
              <div class="like-row">
                <i class="fa-solid fa-comment like-comment"></i>
                <p>33</p>
              </div>
            </div>
            <div class="comments">
              <h3>Comments:</h3>
              <div class="reply-row">
                <p>Gakyeli</p>
                <p>
                  <i class="fa-solid fa-reply reply"></i>
                  reply
                </p>
              </div>
              <div>
                <p class="comment-body">
                  There are many variations of passages of Lorem Ipsum
                  available, but the majority have alteration in some form
                </p>
              </div>
              <p class="comment-date">15th August, 2019 at 01:25 pm</p>

              <div class="reply-row">
                <p>Gakyeli</p>
                <p>
                  <i class="fa-solid fa-reply reply"></i>
                  reply
                </p>
              </div>
              <div>
                <p class="comment-body">
                  There are many variations of passages of Lorem Ipsum
                  available, but the majority have alteration in some form
                </p>
              </div>
              <p class="comment-date">15th August, 2019 at 01:25 pm</p>

              <div class="reply-row">
                <p>Gakyeli</p>
                <p>
                  <i class="fa-solid fa-reply reply"></i>
                  reply
                </p>
              </div>
              <div>
                <p class="comment-body">
                  There are many variations of passages of Lorem Ipsum
                  available, but the majority have alteration in some form
                </p>
              </div>
              <p class="comment-date">15th August, 2019 at 01:25 pm</p>
            </div>

            <div class="leave-comment">
              <h3>Leave a commnent</h3>
              <form action="#" method="post">
                <textarea
                  class="comment-area"
                  placeholder="Your message:"
                  name="message"
                  id=""
                  cols="80"
                  rows="10"
                  required
                ></textarea>

                <input
                  class="contact-input"
                  type="text"
                  placeholder="Your Name:"
                  required
                />

                <input
                  class="contact-input last-child"
                  type="email"
                  placeholder="Your email:"
                  required
                />

                <button class="btn comment">Comment</button>
              </form>
            </div>
          </figure> -->

          <aside>
            <img src="img/aside1.jpg" alt="" />
            <img src="img/aside2.jpg" alt="" />
            <img src="img/aside3.jpg" alt="" />
          </aside>
          <div class="leave-comment">
            <h3>Leave a commnent</h3>
            <form class="comment-form" action="#" method="post">
              <textarea
                class="comment-area"
                placeholder="Your message:"
                name="message"
                id="comment"
                cols="80"
                rows="10"
                required
              ></textarea>

              <input
                class="contact-input"
                type="text"
                id="name"
                placeholder="Your Name:"
                required
              />

              <input
                class="contact-input last-child"
                type="email"
                id="email"
                placeholder="Your email:"
                required
              />

              <button type="submit" class="btn comment">Comment</button>
            </form>
          </div>
        </section>
      </main>
      <footer>Copyright &copy; 2022 by Jean Eric. All rights reserved</footer>
    </div>

    <script>
      let figure_detail = document.querySelector(".blog-text");
      console.log(figure_detail);

      function renderArticle(doc, commentsData) {
        let image = document.createElement("img");
        let tag = document.createElement("div");
        let icon = document.createElement("span");

        let type = document.createElement("h4");
        let blog = document.createElement("p");
        let commentRow = document.createElement("div");
        let likeCount = document.createElement("div");
        let commentCount = document.createElement("div");
        let iconLike = document.createElement("span");
        let iconComment = document.createElement("span");
        let pLike = document.createElement("p");
        let pComment = document.createElement("p");

        let comments = document.createElement("div");
        let commentsTitle = document.createElement("h3");

        comments.className = "comments";
        comments.id = "comments";

        comments.appendChild(commentsTitle);
        commentRow.className = "comment-row";
        likeCount.className = "like-row";
        commentCount.className = "like-row";
        blog.className = "blog-p";
        blog.innerHTML = doc.body;
        tag.className = "tag";
        icon.innerHTML = '<i class="fa-solid fa-tag tag-icon"></i>';
        iconLike.innerHTML =
          '<i class="fa-solid fa-thumbs-up like-comment"></i>';
        iconComment.innerHTML =
          '<i class="fa-solid fa-comment like-comment"></i>';
        pLike.innerHTML = "33";
        pComment.innerHTML = "33";
        type.innerHTML = "Software application";
        image.src = doc.photo;
        console.log(doc.photo);

        likeCount.appendChild(iconLike);
        likeCount.appendChild(pLike);
        commentCount.appendChild(iconComment);
        commentCount.appendChild(pComment);
        commentRow.appendChild(likeCount);
        commentRow.appendChild(commentCount);

        tag.appendChild(icon);
        tag.appendChild(type);
        figure_detail.appendChild(image);
        figure_detail.appendChild(tag);
        figure_detail.appendChild(blog);
        figure_detail.appendChild(commentRow);
        figure_detail.appendChild(comments);

        commentsData.forEach((comment) => {
          console.log(comment);
          let reply = document.createElement("div");
          let commentBody = document.createElement("div");
          let senderComment = document.createElement("p");
          let replyIcon = document.createElement("p");
          let commentDate = document.createElement("p");

          commentBody.className = "comment-body";
          commentDate.className = "comment-date";
          reply.className = "reply-row";
          commentBody.innerHTML = comment.comment;
          commentsTitle.innerHTML = "Comments:";
          senderComment.innerHTML = comment.author;
          replyIcon.innerHTML = '<i class="fa-solid fa-reply reply"></i>reply';
          commentDate.innerHTML = comment.createdAt;

          reply.appendChild(senderComment);
          reply.appendChild(replyIcon);

          comments.appendChild(reply);
          comments.appendChild(commentBody);
          comments.appendChild(commentDate);
        });
      }

      const qString = new URLSearchParams(window.location.search);
      const id = qString.get("article_id");

      fetch(`https://jean-eric-brand-api.herokuapp.com/api/v1/articles/${id}`)
        .then((response) => response.json())
        .then((data) => {
          const article = data.data.data;
          const commentsData = data.data.data.comments;

          renderArticle(article, commentsData);
        });

      const commentForm = document.querySelector(".comment-form");

      commentForm.addEventListener("submit", (e) => {
        e.preventDefault();

        let author = document.getElementById("name").value;
        let email = document.getElementById("email").value;
        let comment = document.getElementById("comment").value;

        fetch(
          `https://jean-eric-brand-api.herokuapp.com/api/v1/articles/${id}/comments`,
          {
            method: "POST",
            headers: {
              Accept: "application/JSON,text/plain,*/*,",
              "Content-type": "application/json",
            },
            body: JSON.stringify({
              author,
              email,
              comment,
            }),
          }
        )
          .then((res) => res.json())
          .then((data) => {
            window.location.reload();
            console.log(data);
            if (data.status === "success") {
              alert("comment added");
              console.log(data);
            } else {
              alert(data.error);
            }
          });

        commentForm.reset();
      });
    </script>
  </body>
</html>
